# 키보드 다루기
- 윈도우 운영체제는 키보드와 관련된 모든 이벤트를 마우스처럼 프로그램에 메시지 형태로 전달한다.
<br><br>

![키보드_메시지_처리](./img/키보드_메시지_처리.png)
- 마우스와 마찬가지로 키보드는 시스템에 한 개만 있는 자원이므로 운영체제는 어느 프로그램에 키보드 메시지를 전달할지 결정해야 한다. 

- 윈도우에서 | 표시를 깜빡이는 방식인 `캐럿(Caret)`과 버튼 내부에 `빗금`을 표시해주는 방식으로 키보드 포커스를 확인할 수 있다.

- 키보드는 포커스는 `활성 윈도우(Active Window, 앞에 있는 윈도우)`와 활성 윈도우의 자식 윈도우가 가지는 일종의 속성이다.

- 윈도우는 키보드 포커스를 얻은 윈도우에 WM_SETFOCUS 메시지를 보내고, 키보드 포커스를 잃은 윈도우에 WM_KILLFOCUS 메시지를 보낸다.

```C++
void CMainFrame::OnSetFocus(CWnd* /*pOldWnd*/)
{
    m_wndView.SetFocus();
}
``` 
- SetFocus() 함수를 호출하여 키보드 포커스를 갖도록 지정할 수 있다.

 캐럿 함수 - MFC
| <center> 함수 이름 </center> | <center> 기능 </center> |
|:--------:|:--------|
| CreateCaret() | 비트맵을 이용해 캐럿을 생성한다. |
| CreateGrayCaret() | 회색 직사각형 캐럿을 생성한다. |
| CreateSolidCaret() | 검은색 직사각형 캐럿을 생성한다. |
| ShowCaret() | 캐럿을 보인다. |
| HideCaret() | 캐럿을 숨긴다. |
| GetCaretPos() | 캐럿의 위치`(클라이언트 좌표)`를 얻는다. |
| SetCaretPos() | 캐럿의 위치`(클라이언트 좌표)`를 설정한다. |

캐럿 함수 - API
| <center> 함수 이름 </center> | <center> 기능 </center> |
|:--------:|:--------|
| ::DestroyCaret() | 캐럿을 파괴한다. |
| ::GetCaretBlinkTime() | 캐럿이 깜박이는 간격을 얻는다. |
| ::SetCaretBlinkTime() | 캐럿이 깜박이는 간격을 설정한다. |

--------------
## 키 누름 메시지
| <center> 메시지 </center> | <center> 발생 시점 </center> |
|:--------:|:--------|
| WM_KEYDOWN | F10, Alt 이외의 키를 누를 때 |
| WM_KEYUP | F10, Alt 이외의 키를 뗄 때 |
| WM_SYSKEYDOWN | F10, Alt, Alt + [키 조합]을 누를 때 |
| WM_SYSKEYUP | F10, Alt, Alt + [키 조합]을 뗄 때|
- 키 누름 메시지는 키보드를 누르거나 떼는 동작으로 발생하는 메시지이다.

- 일반적으로 WM_SYSKEY* 메시지는 운영체제가 처리하며 응용 프로그램은 WM_KEY * 메시지만 처리하지만 특별한 제약은 없다.

- [가상 키 코드(Virtual Key Code)](https://docs.microsoft.com/ko-kr/windows/desktop/inputdev/virtual-key-codes)는 너무 많아서 링크를 첨부한다.


## 키 누름 메시지 핸들러
```C++
afx_msg void On*(UINT nChar, UINT nRepCnt, UINT nFlags);
```

1. nChar : 키에 할당된 키 코드값을 가진다.
2. nRepCnt : 키를 계속 누르고 있으면 1보다 큰 값을 가진다.

3. nFlas : 키와 관련된 부가적인 정보(스캔 코드, 확장 키 여부)를 담고 있다.

-  부분은 메시지의 종류에 따라 달라진다.

------------------

## 문자 메시지
![키보드_메시지_순서](./img/키보드_메시지_순서.png)

```C++
afx_msg void OnChar(UINT nChar, UINT nRepCnt, UINT nFlags);

afx_msg void OnSysChar(UINT nChar, UINT nRepCnt, UINT nFlags);
```

1. nChar : 키에 해당하는 문자 코드값을 가진다.
2. nRepCnt : 키를 계속 누르고 있으면 1보다 큰 값을 가진다.
3. nFlags : 키와 관련된 부가적인 정보를 담고 있다.


